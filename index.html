<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
  />
  <title>Victoria Nurse</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.png" />
  <meta name="theme-color" content="#0b1f3a" />

  <style>
    :root{
      /* Palette from mockup */
      --ink:#e9f3ff;
      --muted:#cbd6e5;
      --bg-top:#0b2c3d;   /* deep teal */
      --bg-mid:#0f3651;   /* dark blue */
      --bg-bot:#112a73;   /* indigo */
      --glass: rgba(255,255,255,.08);
      --glass-bd: rgba(255,255,255,.18);
      --pill-bg: rgba(255,255,255,.10);
      --focus1: rgba(30,136,229,.40);
      --focus2: rgba(38,166,154,.28);
      --grad-btn: linear-gradient(135deg, #1E88E5 0%, #26A69A 100%);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      color:var(--ink);
      background:linear-gradient(180deg, #0c2a3d 0%, #0d3b59 46%, #132a6e 100%);
      background-attachment: fixed;
    }

    .wrap{max-width:980px;margin:0 auto;padding:28px 16px 36px}

    /* Header (centered brand) */
    .brand{
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      margin-top:18px;margin-bottom:22px;text-align:center
    }
    .brand img{width:88px;height:88px;border-radius:18px;box-shadow:0 14px 38px rgba(0,0,0,.35)}
    .brand h1{font-size:clamp(32px,7vw,48px);font-weight:800;letter-spacing:.2px;margin-top:16px}
    .brand .slogan{font-size:clamp(14px,3.5vw,18px);font-style:italic;color:var(--muted);margin-top:6px}

    /* Card (glass) */
    .card{
      background:var(--glass);
      border:1px solid var(--glass-bd);
      border-radius:22px;
      box-shadow:0 22px 60px rgba(0,0,0,.28);
      backdrop-filter: blur(8px);
      padding:18px 16px;
      margin-top:18px;
    }
    h2{font-size:18px;margin-bottom:12px}
    label{display:block;margin:10px 0 6px;color:#d7e6fb;font-weight:600}

    /* Pill inputs */
    input,select,textarea{
      width:100%;
      color:#f4f9ff;
      background:var(--pill-bg);
      border:1px solid var(--glass-bd);
      border-radius:18px;
      padding:14px 14px;
      font-size:15px;
      transition: box-shadow .15s ease, border-color .15s ease, background .15s ease;
    }
    input::placeholder,textarea::placeholder{color:#b8c6d8}
    input:focus, select:focus, textarea:focus{
      outline:none;border-color:transparent;
      box-shadow:
        0 0 0 2px rgba(255,255,255,.8) inset,
        0 0 0 4px var(--focus1),
        0 0 0 8px var(--focus2);
      background:rgba(255,255,255,.14);
    }
    textarea{resize:vertical}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:820px){.grid{grid-template-columns:1fr}}

    /* Table (rounded “glass” block) */
    table{
      width:100%;border-collapse:separate;border-spacing:0;margin-top:10px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--glass-bd); border-radius:18px; overflow:hidden
    }
    thead{background:rgba(255,255,255,.09); color:#eef6ff; user-select:none}
    th,td{padding:12px;border-bottom:1px solid rgba(255,255,255,.12);text-align:center;font-size:14px}
    tbody tr:nth-child(odd){background:rgba(255,255,255,.04)}
    tbody tr:hover{background:rgba(255,255,255,.08)}

    /* Gradient pill buttons */
    .btn-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px}
    .btn{
      flex:1; padding:14px 16px; border:none; border-radius:18px;
      color:#fff; font-weight:800; font-size:15px; letter-spacing:.2px;
      background:var(--grad-btn); box-shadow:0 14px 36px rgba(0,0,0,.28);
      cursor:pointer; transition:transform .05s ease, opacity .2s ease
    }
    .btn:active{transform:translateY(1px);opacity:.95}
    .ghost{background:rgba(255,255,255,.10); color:#e6f5ff; border:1px solid var(--glass-bd)}

    footer{font-size:11px;color:#b4c4db;text-align:center;margin:22px 0 12px;opacity:.9}

    /* Print header shown when “Email” (print) */
    @media print{
      .btn-row{display:none !important}
      body{background:#fff;color:#111}
      .print-header{display:flex !important}
      .card{box-shadow:none;border:1px solid #ccc;background:#fff}
      table{border:1px solid #999}
      th,td{border-bottom:1px solid #999}
      footer{display:none}
    }
    .print-header{display:none; align-items:center; gap:12px; margin:12px auto; max-width:980px}
    .print-header img{width:42px;height:42px;border-radius:8px}
    .print-header h1{font-size:20px; margin:0; color:#1E88E5}
    .print-header small{display:block; color:#333}

    .hidden{display:none !important}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Centered brand -->
    <div class="brand">
      <img src="icons/icon-192.png" alt="Victoria Nurse logo">
      <h1>Victoria Nurse</h1>
      <div class="slogan">Care Together. Stay Together.</div>
    </div>

    <!-- Print header (for PDF/Email) -->
    <div class="print-header">
      <img src="icons/icon-192.png" alt="Logo">
      <div>
        <h1>Victoria Nurse</h1>
        <small>Shared summary & vitals</small>
      </div>
    </div>

    <!-- Combined form -->
    <div class="card">
      <h2>Patient Information</h2>
      <div class="grid">
        <div>
          <label for="formMode">Section</label>
          <select id="formMode">
            <option value="patient">Patient Summary</option>
            <option value="nurse">Nurse Vital Signs</option>
          </select>
        </div>
        <div></div>

        <div>
          <label for="patientName">Patient Name / Initials</label>
          <input id="patientName" placeholder="e.g., A. Mensah">
        </div>
        <div>
          <label for="weekOf">Week Of</label>
          <input type="date" id="weekOf">
        </div>
      </div>

      <!-- Patient-only -->
      <div id="patientOnly" class="grid" style="margin-top:6px">
        <div>
          <label for="startWeight">Starting Weight (kg)</label>
          <input id="startWeight" type="number" step="0.1" placeholder="e.g., 72.4">
        </div>
        <div>
          <label for="endWeight">Ending Weight (kg)</label>
          <input id="endWeight" type="number" step="0.1" placeholder="e.g., 71.9">
        </div>
        <div>
          <label for="recipient">Recipient WhatsApp (with country code)</label>
          <input id="recipient" placeholder="+23324XXXXXXX">
        </div>
        <div>
          <label for="note">Optional Note</label>
          <input id="note" placeholder="Short note (no sensitive identifiers)">
        </div>
      </div>

      <!-- Nurse-only -->
      <div id="nurseOnly" class="hidden" style="margin-top:8px">
        <h3 style="margin:8px 0 6px">Nurse Vital Signs</h3>
        <div class="grid">
          <div><label for="clNurse">Nurse Initials</label><input id="clNurse" placeholder="e.g., KB"></div>
          <div><label for="clTime">Time</label><input id="clTime" type="time"></div>

          <div><label>Temperature (°C/°F)</label><input id="clTemp"></div>
          <div><label>Pulse / HR (bpm)</label><input id="clHR" type="number"></div>
          <div><label>Respiratory Rate (/min)</label><input id="clRR" type="number"></div>
          <div><label>Blood Pressure (mmHg)</label><input id="clBP" placeholder="e.g., 120/80"></div>
          <div><label>Oxygen Saturation (SpO₂ %)</label><input id="clSpO2" type="number"></div>

          <div><label>Pain (0–10)</label><input id="clPain" type="number" min="0" max="10"></div>
          <div><label>LOC (AVPU/GCS)</label><input id="clLOC" placeholder="e.g., Alert / GCS 15"></div>
          <div><label>Blood Glucose</label><input id="clBGL" placeholder="mg/dL or mmol/L"></div>
          <div><label>Weight (kg)</label><input id="clWt" type="number" step="0.1"></div>
          <div><label>Height (cm)</label><input id="clHt" type="number" step="0.1"></div>
          <div><label>Intake (mL)</label><input id="clIn" type="number"></div>
          <div><label>Output (mL)</label><input id="clOut" type="number"></div>

          <div><label>Pulse Characteristics</label><input id="clPulse" placeholder="regular/irregular, strong/weak"></div>
          <div><label>Skin Signs</label><input id="clSkin" placeholder="warm/cool, dry/moist, color"></div>
          <div><label>Capillary Refill (sec)</label><input id="clCap" type="number" step="0.1"></div>
        </div>

        <label style="margin-top:10px">Notes</label>
        <textarea id="clNotes" rows="3" placeholder="Short clinical notes (no sensitive identifiers)"></textarea>
      </div>
    </div>

    <!-- Daily vitals -->
    <div class="card">
      <h2>Daily Vitals</h2>
      <table id="vitalsTable">
        <thead>
          <tr>
            <th>Day</th><th>Time</th><th>AM/PM</th>
            <th>Heart Rate</th><th>Systolic</th><th>Diastolic</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="btn-row">
        <button class="btn" onclick="addRow()">Add Row</button>
        <button class="btn" onclick="addRowPair()">Add AM & PM</button>
        <button class="btn" onclick="doPreview()">Preview</button>
        <button class="btn" onclick="doShare()">Share via WhatsApp</button>
        <button class="btn" onclick="doExportPDF()">Email</button>
        <button class="btn ghost" onclick="clearTable()">Clear</button>
      </div>
    </div>

    <footer>Developed by <strong>Karl Brown</strong> • © <span id="year"></span></footer>
  </div>

  <!-- Preview Modal -->
  <div id="previewModal" class="hidden" style="position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;padding:16px;z-index:1000">
    <div style="background:var(--glass);border:1px solid var(--glass-bd);color:var(--ink);border-radius:16px;max-width:680px;width:92vw;box-shadow:0 16px 40px rgba(0,0,0,.35);padding:16px;backdrop-filter:blur(8px)">
      <h3 style="margin-bottom:10px">Preview message</h3>
      <pre id="previewText" style="white-space:pre-wrap;background:rgba(255,255,255,.06);border:1px solid var(--glass-bd);border-radius:12px;padding:12px;max-height:50vh;overflow:auto"></pre>
      <div class="btn-row" style="margin-top:12px">
        <button class="btn" onclick="copyPreview()">Copy</button>
        <button class="btn ghost" onclick="closePreview()">Close</button>
      </div>
    </div>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);

    /* Section toggler */
    const formMode = $("formMode");
    const patientOnly = $("patientOnly");
    const nurseOnly = $("nurseOnly");
    formMode.addEventListener("change", ()=>{
      const mode = formMode.value;
      if(mode === "patient"){ patientOnly.classList.remove("hidden"); nurseOnly.classList.add("hidden"); }
      else { patientOnly.classList.add("hidden"); nurseOnly.classList.remove("hidden"); }
    });

    /* Table row helpers */
    function addRow(values={}){
      const tbody = document.querySelector("#vitalsTable tbody");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td data-label="Day"><input placeholder="Mon" value="${values.day||''}"></td>
        <td data-label="Time"><input type="time" value="${values.time||''}"></td>
        <td data-label="AM/PM">
          <select>
            <option ${values.meridiem==='AM'?'selected':''}>AM</option>
            <option ${values.meridiem==='PM'?'selected':''}>PM</option>
          </select>
        </td>
        <td data-label="Heart Rate"><input type="number" placeholder="bpm" value="${values.hr||''}"></td>
        <td data-label="Systolic"><input type="number" placeholder="mmHg" value="${values.sys||''}"></td>
        <td data-label="Diastolic"><input type="number" placeholder="mmHg" value="${values.dia||''}"></td>
      `;
      tbody.appendChild(tr);
    }
    function addRowPair(){ addRow({meridiem:'AM'}); addRow({meridiem:'PM'}); }
    function clearTable(){ document.querySelector("#vitalsTable tbody").innerHTML = ""; }

    /* Build nurse section text */
    function clLine(id){ return (document.getElementById(id)?.value || '').trim(); }
    function nurseText(){
      const parts = [
        `Nurse Checklist — ${clLine('patientName') || 'Patient'}`,
        `Week of: ${clLine('weekOf') || ''}  Time: ${clLine('clTime') || ''}  Nurse: ${clLine('clNurse') || ''}`,
        ``,
        `Core Vitals:`,
        `• Temp: ${clLine('clTemp') || '-'}  • HR: ${clLine('clHR') || '-'} bpm  • RR: ${clLine('clRR') || '-'} /min`,
        `• BP: ${clLine('clBP') || '-'} mmHg  • SpO₂: ${clLine('clSpO2') || '-'} %`,
        ``,
        `Extended:`,
        `• Pain: ${clLine('clPain') || '-'} /10  • LOC: ${clLine('clLOC') || '-'}`,
        `• BGL: ${clLine('clBGL') || '-'}  • Wt: ${clLine('clWt') || '-'} kg  • Ht: ${clLine('clHt') || '-'} cm`,
        `• Intake: ${clLine('clIn') || '-'} mL  • Output: ${clLine('clOut') || '-'} mL`,
        ``,
        `Observations:`,
        `• Pulse: ${clLine('clPulse') || '-'}`,
        `• Skin: ${clLine('clSkin') || '-'}`,
        `• Cap refill: ${clLine('clCap') || '-'} sec`,
        ``,
        `Notes: ${clLine('clNotes') || ''}`
      ];
      return parts.join('\\n');
    }

    /* Build share text */
    function buildShareText(){
      const name = $("patientName").value.trim() || "Patient";
      const week = $("weekOf").value || "(week not set)";
      const sw = $("startWeight")?.value;
      const ew = $("endWeight")?.value;
      const note = $("note")?.value?.trim() || "";

      const rows = [...document.querySelectorAll("#vitalsTable tbody tr")].map(tr=>{
        const day  = tr.children[0].querySelector('input').value || '';
        const time = tr.children[1].querySelector('input').value || '';
        const ampm = tr.children[2].querySelector('select').value || '';
        const hr   = tr.children[3].querySelector('input').value || '';
        const sys  = tr.children[4].querySelector('input').value || '';
        const dia  = tr.children[5].querySelector('input').value || '';
        return `• ${day} ${time} ${ampm} — HR ${hr} bpm, ${sys}/${dia} mmHg`;
      });

      let msg = `Victoria Nurse — ${name}\\nWeek of ${week}\\n`;
      if (sw) msg += `Start Wt: ${sw} kg\\n`;
      if (ew) msg += `End Wt: ${ew} kg\\n`;
      msg += `\\nDaily Vitals:\\n`;
      msg += rows.length ? rows.join('\\n') + '\\n' : '  (no rows yet)\\n';
      if (note) msg += `\\nNote: ${note}\\n`;

      if (!document.getElementById('nurseOnly').classList.contains('hidden')) {
        msg += `\\n————————————\\n` + nurseText();
      }
      return msg;
    }

    /* Clear everything after sharing */
    function clearAll(){
      document.querySelectorAll('input, textarea').forEach(el => {
        if (el.type === 'checkbox' || el.type === 'radio') { el.checked = false; }
        else { el.value = ''; }
      });
      clearTable();
      formMode.value = 'patient';
      patientOnly.classList.remove('hidden'); nurseOnly.classList.add('hidden');
    }

    /* Preview / Share / Email */
    function doPreview(){
      document.getElementById("previewText").textContent = buildShareText();
      document.getElementById("previewModal").classList.remove("hidden");
    }
    function closePreview(){ document.getElementById("previewModal").classList.add("hidden"); }
    function copyPreview(){
      navigator.clipboard.writeText(document.getElementById("previewText").textContent).then(()=> alert("Copied!"));
    }

    function doShare(){
      const msg = buildShareText();
      const phone = document.getElementById("recipient")?.value?.trim();
      const wa = phone ? `https://wa.me/${encodeURIComponent(phone)}?text=${encodeURIComponent(msg)}`
                       : `https://wa.me/?text=${encodeURIComponent(msg)}`;
      window.open(wa, "_blank");
      clearAll();
    }

    function doExportPDF(){
      window.print();
      clearAll();
    }

    /* Footer year */
    (function(){ const y=document.getElementById('year'); if (y) y.textContent = new Date().getFullYear(); })();

    /* PWA */
    if ('serviceWorker' in navigator){
      window.addEventListener('load', () => {
        try { navigator.serviceWorker.register('./service-worker.js'); } catch(e){}
      });
    }
  </script>
</body>
</html>
