<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Victoria Nurse</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.png">
  <meta name="theme-color" content="#1E88E5" />

  <style>
    :root{
      --primary:#1E88E5;        /* medical blue */
      --primary-2:#26A69A;      /* teal accent */
      --bg:#F5F7FA;             /* soft grey page */
      --card:#FFFFFF;           /* white card */
      --text:#2C3E50;           /* neutral text */
      --muted:#607D8B;          /* muted labels */
      --border:#E3E8EF;         /* light border */
      --shadow: 0 6px 20px rgba(30,136,229,0.08);
      --grad-btn: linear-gradient(135deg, #1E88E5 0%, #26A69A 100%);
      --grad-header: linear-gradient(90deg, #1E88E5 0%, #26A69A 100%);
      --grad-welcome: linear-gradient(160deg, #0ea5e9 0%, #1E88E5 35%, #4f46e5 70%, #0b5bd3 100%);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:linear-gradient(180deg,#f6f9ff 0%,#eef5ff 100%);
      color:var(--text)
    }

    #landing{min-height:100svh; display:flex; flex-direction:column;}
    .hero{
      height:50svh; width:100%;
      background:url('assets/nurse-hero.jpg') center/cover no-repeat;
      position:relative;
    }
    .welcome{
      flex:1; display:flex; align-items:center; justify-content:center;
      text-align:center; padding:28px 18px;
      background:var(--grad-welcome);
      color:#fff;
    }
    .welcome .box{
      max-width:760px; width:100%;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.18);
      box-shadow:0 10px 30px rgba(0,0,0,0.15);
      backdrop-filter: blur(6px);
      border-radius:20px; padding:28px 20px;
    }
    .welcome h1{ font-size:clamp(26px, 5vw, 42px); letter-spacing:.3px; line-height:1.15; margin-bottom:10px; }
    .welcome p{opacity:.92; margin-bottom:16px}
    .start-btn{
      appearance:none; border:none; cursor:pointer;
      padding:12px 18px; border-radius:14px;
      font-weight:800; font-size:16px; letter-spacing:.2px;
      color:#fff; background:var(--grad-btn); box-shadow:var(--shadow);
      transition: transform .05s ease, opacity .2s ease;
    }
    .start-btn:active{ transform: translateY(1px); opacity:.95; }

    .app-header{
      display:flex;align-items:center;gap:14px;
      background:var(--grad-header);color:#fff;
      padding:16px 18px;border-bottom:3px solid #1565C0; display:none;
    }
    .app-header .logo{ width:44px;height:44px;border-radius:10px;box-shadow:var(--shadow); }
    .app-header .brand h1{font-size:18px;line-height:1.1;margin:0}
    .app-header .brand .tagline{margin-top:2px;font-size:11px;opacity:.92}

    #app{display:none}
    .wrap{max-width:900px;margin:18px auto 24px;padding:0 14px}
    .card{ background:var(--card);border-radius:16px;box-shadow:var(--shadow); padding:18px 16px;margin-top:16px }
    h2{font-size:18px;margin-bottom:10px;color:var(--primary)}
    label{display:block;margin:10px 0 6px;color:var(--muted);font-weight:600}

    input,select,textarea{ font-size:15px; padding:10px; margin-bottom:8px; width:100%; border:1px solid var(--border); border-radius:8px; background:#fff }
    textarea{resize:vertical}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}

    table{width:100%;border-collapse:collapse;margin-top:10px;background:#fff;border:1px solid var(--border);border-radius:10px;overflow:hidden}
    thead{background:var(--primary);color:#fff}
    th,td{padding:10px;border-bottom:1px solid var(--border);text-align:center;font-size:14px}
    tbody tr:nth-child(odd){background:#fafcff}
    tbody tr:hover{background:#f3f9ff}

    .btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .btn{ flex:1;padding:10px 12px;border:none;border-radius:10px;color:#fff;font-weight:700;font-size:15px; background:var(--grad-btn);box-shadow:var(--shadow);cursor:pointer;transition:transform .05s ease,opacity .2s ease }
    .btn:active{transform:translateY(1px);opacity:.95}
    .ghost{background:#fff;color:var(--primary);border:1px solid var(--primary);box-shadow:none}

    footer.signature { font-size:11px;color:#8899aa;text-align:center;margin:18px auto 28px;max-width:900px; padding:8px 0;border-top:1px solid var(--border);font-style:italic;letter-spacing:.5px }
    footer.signature strong{color:#1E88E5;font-style:normal}

    @media (max-width:640px){
      table thead{display:none}
      table,tbody,tr,td{display:block;width:100%}
      tr{margin:8px 0;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:#fff}
      td{text-align:left;padding:8px 10px;border-bottom:1px solid var(--border)}
      td:last-child{border-bottom:none}
      td::before{content:attr(data-label);font-weight:700;margin-right:8px;display:inline-block;min-width:120px;color:#2c3e50}
      .btn{width:100%;font-size:15px;padding:10px}
    }

    @media print{
      #landing,.app-header,.btn-row,.modal,.ghost{display:none !important}
      body{background:#fff}
      .wrap{margin:0;padding:0}
      .card{box-shadow:none;border:none;padding:0}
      table{border:1px solid #999}
      th,td{border:1px solid #999}
      footer.signature{display:none}
    }

    .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:16px;z-index:1000}
    .modal.show{display:flex}
    .modal .sheet{background:#fff;border-radius:14px;max-width:680px;width:100%;box-shadow:var(--shadow);padding:16px}
    .modal h3{margin-bottom:10px;color:var(--primary)}
    .modal pre{white-space:pre-wrap;background:#f6f9ff;border:1px solid var(--border);border-radius:10px;padding:12px;max-height:50vh;overflow:auto}
  </style>
</head>

<body>
  <section id="landing" aria-label="Welcome">
    <div class="hero" role="img" aria-label="Nurse with patient"></div>
    <div class="welcome">
      <div class="box">
        <h1>Welcome to <strong>Victoria Nurse</strong></h1>
        <p>Your digital nursing companion for capturing, previewing, and sharing vitals securely with loved ones and care teams.</p>
        <button class="start-btn" id="startBtn">Start</button>
      </div>
    </div>
  </section>

  <header class="app-header" id="appHeader">
    <img src="icons/icon-192.png" alt="Victoria Nurse Logo" class="logo" />
    <div class="brand">
      <h1>Victoria Nurse</h1>
      <p class="tagline">Your digital nursing companion</p>
    </div>
  </header>

  <main id="app" role="main" aria-label="Main app">
    <div class="wrap">
      <div class="card">
        <h2>Patient Summary</h2>
        <div class="grid">
          <div><label for="patientName">Patient name / initials</label><input id="patientName" placeholder="e.g., A. Mensah"></div>
          <div><label for="weekOf">Week of</label><input type="date" id="weekOf"></div>
          <div><label for="startWeight">Starting weight (kg)</label><input id="startWeight" type="number" step="0.1" placeholder="e.g., 72.4"></div>
          <div><label for="endWeight">Ending weight (kg)</label><input id="endWeight" type="number" step="0.1" placeholder="e.g., 71.9"></div>
          <div><label for="recipient">Recipient WhatsApp number (with country code)</label><input id="recipient" placeholder="+23324XXXXXXX"></div>
          <div><label for="note">Optional note</label><input id="note" placeholder="Short note (no sensitive identifiers)"></div>
        </div>
      </div>

      <div class="card">
        <h2>Daily Vitals</h2>
        <table id="vitalsTable">
          <thead>
            <tr><th>Day</th><th>Time</th><th>AM/PM</th><th>Heart Rate</th><th>Systolic</th><th>Diastolic</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="btn-row">
          <button class="btn ghost" onclick="addRow()">➕ Add Row</button>
          <button class="btn ghost" onclick="addRowPair()">➕ Add AM & PM</button>
          <button class="btn" onclick="doPreview()">Preview</button>
          <button class="btn" onclick="doShare()">Share via WhatsApp</button>
          <button class="btn" onclick="doExportPDF()">Export to PDF</button>
          <button class="btn ghost" onclick="clearTable()">Clear</button>
        </div>
      </div>

      <div class="card" id="checklistCard">
        <h2>Nurse Vital Signs Checklist</h2>
        <div class="grid">
          <div><label for="clName">Patient name / initials</label><input id="clName"></div>
          <div><label for="clDate">Date (Week Of)</label><input type="date" id="clDate"></div>
          <div><label for="clNurse">Nurse initials</label><input id="clNurse" placeholder="e.g., KB"></div>
          <div><label for="clTime">Time</label><input id="clTime" type="time"></div>
        </div>
        <h3 style="margin:12px 0 6px;color:#1E88E5">Core Vital Signs</h3>
        <div class="grid">
          <div><label>Temperature (°C/°F)</label><input id="clTemp"></div>
          <div><label>Pulse / HR (bpm)</label><input id="clHR" type="number"></div>
          <div><label>Respiratory rate (breaths/min)</label><input id="clRR" type="number"></div>
          <div><label>Blood Pressure (mmHg)</label><input id="clBP" placeholder="e.g., 120/80"></div>
          <div><label>Oxygen saturation (SpO₂ %)</label><input id="clSpO2" type="number"></div>
        </div>
        <h3 style="margin:12px 0 6px;color:#1E88E5">Extended Checks</h3>
        <div class="grid">
          <div><label>Pain level (0–10)</label><input id="clPain" type="number" min="0" max="10"></div>
          <div><label>LOC (AVPU/GCS)</label><input id="clLOC" placeholder="e.g., Alert / GCS 15"></div>
          <div><label>Blood glucose</label><input id="clBGL" placeholder="mg/dL or mmol/L"></div>
          <div><label>Weight (kg)</label><input id="clWt" type="number" step="0.1"></div>
          <div><label>Height (cm)</label><input id="clHt" type="number" step="0.1"></div>
          <div><label>Intake (mL)</label><input id="clIn" type="number"></div>
          <div><label>Output (mL)</label><input id="clOut" type="number"></div>
        </div>
        <h3 style="margin:12px 0 6px;color:#1E88E5">Observations</h3>
        <div class="grid">
          <div><label>Pulse characteristics</label><input id="clPulse" placeholder="regular/irregular, strong/weak"></div>
          <div><label>Skin signs</label><input id="clSkin" placeholder="warm/cool, dry/moist, color"></div>
          <div><label>Capillary refill (sec)</label><input id="clCap" type="number" step="0.1"></div>
        </div>
        <label style="margin-top:10px">Notes</label>
        <textarea id="clNotes" rows="3" placeholder="Short clinical notes (no sensitive identifiers)"></textarea>
        <div style="margin-top:10px">
          <label style="display:flex;align-items:center;gap:8px;font-weight:600;color:#607D8B">
            <input id="includeChecklist" type="checkbox" checked> Include this checklist in Preview / Share / PDF
          </label>
        </div>
        <div class="btn-row" style="margin-top:10px">
          <button class="btn ghost" onclick="navigator.clipboard.writeText(clBuildText()).then(()=>alert('Checklist copied'))">Copy Checklist Only</button>
        </div>
      </div>
    </div>
  </main>

  <footer class="signature">Developed by <strong>Karl Brown</strong> © <span id="year"></span></footer>

  <div class="modal" id="previewModal" aria-modal="true" role="dialog" aria-labelledby="previewTitle">
    <div class="sheet">
      <h3 id="previewTitle">Preview message</h3>
      <pre id="previewText"></pre>
      <div class="btn-row" style="margin-top:12px">
        <button class="btn" onclick="copyPreview()">Copy</button>
        <button class="btn ghost" onclick="closePreview()">Close</button>
      </div>
    </div>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);

    const startBtn = document.getElementById('startBtn');
    startBtn.addEventListener('click', () => {
      document.getElementById('landing').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      document.getElementById('appHeader').style.display = 'flex';
      window.scrollTo({top:0, behavior:'smooth'});
    });

    function addRow(values={}){
      const tbody = document.querySelector("#vitalsTable tbody");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td data-label="Day"><input placeholder="Mon" value="${values.day||''}"></td>
        <td data-label="Time"><input type="time" value="${values.time||''}"></td>
        <td data-label="AM/PM">
          <select>
            <option ${values.meridiem==='AM'?'selected':''}>AM</option>
            <option ${values.meridiem==='PM'?'selected':''}>PM</option>
          </select>
        </td>
        <td data-label="Heart Rate"><input type="number" placeholder="bpm" value="${values.hr||''}"></td>
        <td data-label="Systolic"><input type="number" placeholder="mmHg" value="${values.sys||''}"></td>
        <td data-label="Diastolic"><input type="number" placeholder="mmHg" value="${values.dia||''}"></td>
      `;
      tbody.appendChild(tr);
    }
    function addRowPair(){ addRow({meridiem:'AM'}); addRow({meridiem:'PM'}); }
    function clearTable(){ document.querySelector("#vitalsTable tbody").innerHTML = ""; }

    function clBuildText(){
      const get = id => (document.getElementById(id)?.value || '').trim();
      const lines = [
        `Nurse Checklist — ${get('clName') || 'Patient'}`,
        `Date: ${get('clDate') || ''}  Time: ${get('clTime') || ''}  Nurse: ${get('clNurse') || ''}`,
        ``,
        `Core Vitals:`,
        `• Temp: ${get('clTemp') || '-'}  • HR: ${get('clHR') || '-'} bpm  • RR: ${get('clRR') || '-'} /min`,
        `• BP: ${get('clBP') || '-'} mmHg  • SpO₂: ${get('clSpO2') || '-'} %`,
        ``,
        `Extended Checks:`,
        `• Pain: ${get('clPain') || '-'} /10  • LOC: ${get('clLOC') || '-'}`,
        `• BGL: ${get('clBGL') || '-'}  • Wt: ${get('clWt') || '-'} kg  • Ht: ${get('clHt') || '-'} cm`,
        `• Intake: ${get('clIn') || '-'} mL  • Output: ${get('clOut') || '-'} mL`,
        ``,
        `Observations:`,
        `• Pulse: ${get('clPulse') || '-'}`,
        `• Skin: ${get('clSkin') || '-'}`,
        `• Cap refill: ${get('clCap') || '-'} sec`,
        ``,
        `Notes: ${get('clNotes') || ''}`
      ];
      return lines.join('\n');
    }

    function gather(includeChecklist = false){
      const name = $("patientName").value.trim() || "Patient";
      const week = $("weekOf").value || "(week not set)";
      const sw = $("startWeight").value;
      const ew = $("endWeight").value;
      const note = $("note").value.trim();

      const rows = [...document.querySelectorAll("#vitalsTable tbody tr")].map(tr=>{
        const day  = tr.children[0].querySelector('input').value || '';
        const time = tr.children[1].querySelector('input').value || '';
        const ampm = tr.children[2].querySelector('select').value || '';
        const hr   = tr.children[3].querySelector('input').value || '';
        const sys  = tr.children[4].querySelector('input').value || '';
        const dia  = tr.children[5].querySelector('input').value || '';
        return {day,time,ampm,hr,sys,dia};
      });

      let msg = `Victoria Nurse — ${name}\nWeek of ${week}\n`;
      if (sw) msg += `Start Wt: ${sw} kg\n`;
      if (ew) msg += `End Wt: ${ew} kg\n`;
      msg += `\nReadings:\n`;
      if (rows.length===0){ msg += `  (no rows yet)\n`; }
      rows.forEach(r=>{ msg += `• ${r.day} ${r.time} ${r.ampm} — HR ${r.hr} bpm, ${r.sys}/${r.dia} mmHg\n`; });
      if (note) msg += `\nNote: ${note}\n`;

      if (includeChecklist){
        msg += `\n————————————\n` + clBuildText();
      }

      return {name, week, sw, ew, note, rows, msg};
    }

    function doPreview(){
      const include = document.getElementById('includeChecklist')?.checked;
      const {msg} = gather(!!include);
      $("previewText").textContent = msg;
      $("previewModal").classList.add("show");
    }
    function closePreview(){ $("previewModal").classList.remove("show"); }
    function copyPreview(){
      const text = $("previewText").textContent;
      navigator.clipboard.writeText(text).then(()=> alert("Copied!"));
    }

    function doShare(){
      const include = document.getElementById('includeChecklist')?.checked;
      const {msg} = gather(!!include);
      const phone = $("recipient").value.trim();
      const wa = phone ? `https://wa.me/${encodeURIComponent(phone)}?text=${encodeURIComponent(msg)}`
                       : `https://wa.me/?text=${encodeURIComponent(msg)}`;
      window.open(wa, "_blank");
    }

    function doExportPDF(){ window.print(); }

    (function(){ const y=$("year"); if (y) y.textContent = new Date().getFullYear(); })();

    if ('serviceWorker' in navigator){
      window.addEventListener('load', () => {
        try { navigator.serviceWorker.register('./service-worker.js'); }
        catch(e){ console.warn('SW register failed', e); }
      });
    }

    (function(){
      const params = new URLSearchParams(location.search);
      const action = (params.get('action')||'').toLowerCase();
      const run = () => {
        try {
          switch(action){
            case 'add-reading': addRowPair(); break;
            case 'preview': doPreview(); break;
            case 'export': doExportPDF(); break;
            case 'share': doShare(); break;
            default: break;
          }
        } catch(e){ console.error('Shortcut failed', e); }
      };
      if (document.readyState === 'complete') setTimeout(run, 150);
      else window.addEventListener('load', ()=> setTimeout(run,150));
    })();
  </script>
</body>
</html>
