<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#E6F3FF" />
  <meta name="referrer" content="no-referrer">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; img-src 'self' data: blob:; style-src 'self' 'unsafe-inline'; script-src 'self'; font-src 'self'; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self' mailto:;">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png" />
  <title>Victoria Nurse</title>
  <style>
    :root {
      /* Light blue gradient palette */
      --bg-0:#E6F3FF;        /* light sky background */
      --bg-1:#F7FBFF;        /* white-blue blend */
      --card-1:#FFFFFF;
      --card-2:#F1F8FF;
      --ink:#083D77;         /* deep navy text */
      --muted:#52799F;       /* muted blue text */
      --line:#C2DDF2;        /* soft divider */
      --accent:#5BA9F2;      /* medium blue accent */
      --accent-2:#82C4FF;    /* lighter accent */
      --danger:#E63946;      /* error red */
      --radius:14px;
      --shadow:0 4px 18px rgba(0,0,0,.12);
      --focus:0 0 0 3px rgba(91,169,242,.35);
    }
    body {
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--ink);
      background:linear-gradient(180deg,var(--bg-0),var(--bg-1));
    }
    .wrap{max-width:640px;margin:0 auto;padding:24px 18px 96px}
    header{text-align:center;margin-bottom:18px}
    .logo{
      width:72px;height:72px;border-radius:50%;background:linear-gradient(180deg,#5BA9F2,#82C4FF);
      display:grid;place-items:center;margin:0 auto 8px;box-shadow:var(--shadow)
    }
    .logo svg{width:46px;height:46px}
    h1{margin:0;font-size:32px}
    .slogan{margin-top:4px;color:var(--muted);font-size:15px;font-style:italic}
    .badge{margin-top:6px;color:var(--muted);font-size:12px}
    .card{
      background:linear-gradient(180deg,var(--card-1),var(--card-2));
      border-radius:var(--radius);box-shadow:var(--shadow);
      padding:16px;margin:12px 0;border:1px solid var(--line);
    }
    label{display:block;font-size:14px;margin:4px 0 8px;color:var(--ink)}
    input, select, textarea{
      width:100%;border:1px solid var(--line);outline:none;font-size:16px;
      background:#fff;color:var(--ink);
      padding:12px;border-radius:12px;
    }
    input:focus,select:focus,textarea:focus{box-shadow:var(--focus);border-color:transparent}
    textarea{min-height:90px;resize:vertical}
    .table-wrap{overflow:auto;border:1px solid var(--line);border-radius:12px}
    table{width:100%;border-collapse:collapse}
    thead th{background:#E6F3FF;position:sticky;top:0;font-size:13px;font-weight:600;padding:8px;text-align:left}
    td{padding:6px;border-bottom:1px solid var(--line)}
    .row-input{width:100%;padding:8px;border-radius:8px;border:1px solid var(--line);background:#F9FCFF}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
    .btn{
      flex:1 1 auto;cursor:pointer;border:none;outline:none;
      padding:12px;border-radius:12px;font-weight:600;font-size:15px;
      color:#fff;background:linear-gradient(180deg,var(--accent),var(--accent-2));
      box-shadow:var(--shadow)
    }
    .btn.secondary{background:linear-gradient(180deg,#A0D2FF,#7CB8F7)}
    .btn.flat{background:#fff;color:var(--ink);border:1px solid var(--line)}
    .alert{color:var(--danger);font-size:13px;margin-top:6px}
    .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background:#083D77;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;transition:opacity .25s}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">
        <svg viewBox="0 0 64 64" fill="none">
          <rect x="8" y="8" width="48" height="48" rx="10" fill="#5BA9F2" opacity=".25"/>
          <path d="M8 34h15l6-16 8 26 6-12h13" stroke="#2A78D2" stroke-width="4" stroke-linecap="round"/>
        </svg>
      </div>
      <h1>Victoria Nurse</h1>
      <div class="slogan">Care with Clarity</div>
      <div class="badge">No storage · Clears after send</div>
    </header>

    <section class="card">
      <label for="summary">Patient Summary</label>
      <textarea id="summary" placeholder="Observations / notes"></textarea>
    </section>

    <section class="card">
      <label for="patient">Patient Name / Initials</label>
      <input id="patient" placeholder="e.g., J.D." />
      <label for="weekof" style="margin-top:12px">Week Of</label>
      <input id="weekof" type="date" />
      <div id="weekRange" style="font-size:13px;color:var(--muted);margin-top:6px"></div>
    </section>

    <section class="card">
      <label>Daily Vitals</label>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Day</th><th>Time</th><th>AM/PM</th><th>HR</th><th>Sys</th><th>Dia</th><th></th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
      <div class="controls">
        <button class="btn flat" id="addRowBtn">Add Row</button>
        <button class="btn flat" id="addAmPmBtn">Add AM & PM</button>
        <button class="btn flat" id="panicClearBtn">Clear</button>
      </div>
      <div id="valMsg" class="alert"></div>
    </section>

    <section class="card">
      <div class="controls">
        <button class="btn" id="shareBtn">Share / Email (CSV)</button>
        <button class="btn secondary" id="downloadBtn">Download CSV</button>
      </div>
    </section>
  </div>
  <div class="toast" id="toast"></div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const rowsEl = $('#rows'); const weekInput=$('#weekof'); const weekRange=$('#weekRange');
    const toast=$('#toast'); const valMsg=$('#valMsg');
    const state={rows:[],weekOf:null};

    const showToast=(m)=>{toast.textContent=m;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),2200);};
    const fmtISO=(d)=>d.toISOString().slice(0,10);
    const dayName=(d)=>d.toLocaleDateString(undefined,{weekday:'short'});
    const startOfWeek=(d)=>{const dt=new Date(d);const day=(dt.getDay()+6)%7;dt.setDate(dt.getDate()-day);return dt;};
    const endOfWeek=(d)=>{const s=startOfWeek(d);const e=new Date(s);e.setDate(e.getDate()+6);return e;};

    function updateWeekRange(){
      if(!weekInput.value){weekRange.textContent='';return;}
      const s=startOfWeek(weekInput.value),e=endOfWeek(weekInput.value);
      weekRange.textContent=`${s.toLocaleDateString()} – ${e.toLocaleDateString()}`;
      state.weekOf=fmtISO(s);
    }
    function newRow(dayISO,t="07:00"){const h=parseInt(t.split(':')[0],10);const mer=h<12?'AM':'PM';return{id:crypto.randomUUID(),dayISO,time24h:t,meridiem:mer,heartRate:'',systolic:'',diastolic:''};}
    function addRow(){const d=state.weekOf||fmtISO(new Date());state.rows.push(newRow(d,new Date().toTimeString().slice(0,5)));renderRows();}
    function seed(){if(!weekInput.value){showToast("Pick week");return;}const s=startOfWeek(weekInput.value);for(let i=0;i<7;i++){const d=new Date(s);d.setDate(s.getDate()+i);state.rows.push(newRow(fmtISO(d),"07:00"));state.rows.push(newRow(fmtISO(d),"19:00"));}renderRows();}
    function del(id){state.rows=state.rows.filter(r=>r.id!==id);renderRows();}
    function renderRows(){rowsEl.innerHTML='';state.rows.forEach(r=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${dayName(new Date(r.dayISO))}</td><td><input class="row-input" type="time" value="${r.time24h}"></td><td><select class="row-input"><option ${r.meridiem==='AM'?'selected':''}>AM</option><option ${r.meridiem==='PM'?'selected':''}>PM</option></select></td><td><input class="row-input" value="${r.heartRate}"></td><td><input class="row-input" value="${r.systolic}"></td><td><input class="row-input" value="${r.diastolic}"></td><td><button class="btn flat">✕</button></td>`;const [t,m,h,s,d,b]=tr.querySelectorAll('input,select,button');t.onchange=e=>{r.time24h=e.target.value;};m.onchange=e=>r.meridiem=e.target.value;h.oninput=e=>r.heartRate=e.target.value.replace(/\D/g,'');s.oninput=e=>r.systolic=e.target.value.replace(/\D/g,'');d.oninput=e=>r.diastolic=e.target.value.replace(/\D/g,'');b.onclick=()=>del(r.id);rowsEl.appendChild(tr);});}
    function validate(){valMsg.textContent='';for(const r of state.rows){if(!r.heartRate&&!r.systolic&&!r.diastolic)continue;const hr=+r.heartRate,sys=+r.systolic,dia=+r.diastolic;if(hr&&(hr<30||hr>220)){valMsg.textContent="HR out of range";return false;}if(sys&&(sys<60||sys>250)){valMsg.textContent="Sys out of range";return false;}if(dia&&(dia<30||dia>150)){valMsg.textContent="Dia out of range";return false;}if(sys&&dia&&sys<=dia){valMsg.textContent="Sys must > Dia";return false;}}return true;}
    function toCSV(){const header="dayISO,time24h,AM/PM,HR,Sys,Dia";const lines=[header];state.rows.forEach(r=>lines.push([r.dayISO,r.time24h,r.meridiem,r.heartRate,r.systolic,r.diastolic].join(",")));return lines.join("\\n");}
    function filename(ext){return`victoria-nurse_${Date.now()}.${ext}`;}
    async function share(){if(!validate())return;const csv=toCSV();const blob=new Blob([csv],{type:'text/csv'});const f=new File([blob],filename('csv'),{type:'text/csv'});try{if(navigator.share&&navigator.canShare({files:[f]})){await navigator.share({files:[f],title:"Victoria Nurse"});clear();showToast("Sent & cleared");}else{download(blob);showToast("CSV saved");}}catch{showToast("Share canceled");}}
    function download(b){const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=filename('csv');a.click();URL.revokeObjectURL(a.href);}
    function clear(){state.rows=[];$('#summary').value='';$('#patient').value='';weekInput.value='';weekRange.textContent='';renderRows();}
    $('#addRowBtn').onclick=addRow;$('#addAmPmBtn').onclick=seed;$('#panicClearBtn').onclick=clear;weekInput.onchange=updateWeekRange;$('#shareBtn').onclick=share;$('#downloadBtn').onclick=()=>download(new Blob([toCSV()],{type:'text/csv'}));
    if('serviceWorker'in navigator)navigator.serviceWorker.register('./sw.js');
  </script>
</body>
</html>
