<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Victoria Nurse</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.png">
  <meta name="theme-color" content="#0f2748" />

  <style>
    :root{
      /* Dark, premium gradient theme */
      --ink:#e6f5ff;
      --muted:#c9d7e6;
      --bg-top:#0ea5e9;    /* teal */
      --bg-mid:#1E88E5;    /* medical blue */
      --bg-bot:#4338ca;    /* indigo */
      --card:#0f2748cc;    /* translucent slate */
      --border:#2a4466;
      --focus1: rgba(30,136,229,.35);
      --focus2: rgba(38,166,154,.25);
      --grad-btn: linear-gradient(135deg, #1E88E5 0%, #26A69A 100%);
      --grad-header: linear-gradient(135deg, #1E88E5 0%, #26A69A 100%);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      color:var(--ink);
      background: linear-gradient(180deg, var(--bg-top) 0%, var(--bg-mid) 48%, var(--bg-bot) 100%);
      background-attachment: fixed;
    }

    /* ---------- Landing ---------- */
    #landing{min-height:100svh; display:flex; flex-direction:column;}
    .hero{
      height:48svh; width:100%;
      background:url('assets/nurse-hero.jpg') center/cover no-repeat;
      position:relative;
    }
    .welcome{
      flex:1; display:flex; align-items:center; justify-content:center;
      padding:24px 18px; position:relative;
    }
    .welcome .panel{
      width:min(920px, 92vw);
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.18);
      border-radius:22px;
      box-shadow:0 20px 60px rgba(0,0,0,.25);
      backdrop-filter: blur(8px);
      padding:26px 20px;
      text-align:center;
    }
    .brand-mark{
      display:flex; align-items:center; justify-content:center; gap:14px; margin-bottom:6px;
      color:#fff; text-decoration:none;
    }
    .brand-mark img{width:56px;height:56px;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .brand-mark h1{font-size:clamp(28px, 6vw, 42px); font-weight:800; letter-spacing:.2px}
    .slogan{
      font-size:clamp(13px, 2.6vw, 16px);
      font-style:italic; color:var(--muted); margin-bottom:16px; margin-top:2px;
    }
    .start-btn{
      appearance:none; border:none; cursor:pointer;
      padding:12px 18px; border-radius:16px; color:#fff; font-weight:800; font-size:16px;
      background:var(--grad-btn); box-shadow:0 10px 28px rgba(0,0,0,.25);
      transition: transform .05s ease, opacity .2s ease;
    }
    .start-btn:active{ transform: translateY(1px); opacity:.95; }

    /* ---------- App header ---------- */
    .app-header{
      display:none; align-items:center; gap:14px;
      background:var(--grad-header); color:#fff; padding:14px 16px;
      border-bottom:2px solid rgba(255,255,255,.25);
    }
    .brand-link{display:flex; align-items:center; gap:12px; color:#fff; text-decoration:none}
    .app-header .logo{width:44px;height:44px;border-radius:10px;box-shadow:0 8px 22px rgba(0,0,0,.25)}
    .app-header h1{font-size:18px;margin:0}
    .app-header .tag{font-size:11px;opacity:.9}

    /* ---------- Cards / layout ---------- */
    #app{display:none}
    .wrap{max-width:980px;margin:18px auto 28px;padding:0 14px}
    .card{
      background:var(--card); border:1px solid var(--border);
      border-radius:20px; padding:18px 16px; box-shadow:0 18px 50px rgba(0,0,0,.28);
      backdrop-filter: blur(6px); margin-top:16px;
    }
    h2{font-size:18px;margin-bottom:10px}
    label{display:block;margin:10px 0 6px;color:#d9e6f7;font-weight:600}

    /* Inputs with gradient glow on focus */
    input,select,textarea{
      color:#f2f7ff; background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.18);
      border-radius:14px; padding:12px 12px; width:100%; font-size:15px;
      transition: box-shadow .15s ease, border-color .15s ease, background .15s ease;
    }
    input::placeholder, textarea::placeholder{color:#b8c6d8}
    input:focus, select:focus, textarea:focus{
      outline:none; border-color:transparent;
      box-shadow:
        0 0 0 2px rgba(255,255,255,.8) inset,
        0 0 0 4px var(--focus1),
        0 0 0 8px var(--focus2);
      background:rgba(255,255,255,.08);
    }
    textarea{resize:vertical}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:820px){.grid{grid-template-columns:1fr}}

    /* Table */
    table{width:100%;border-collapse:separate;border-spacing:0;margin-top:10px;
      background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.16); border-radius:16px; overflow:hidden}
    thead{background:rgba(255,255,255,.08); color:#e7f1ff; user-select:none}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.12);text-align:center;font-size:14px}
    tbody tr:nth-child(odd){background:rgba(255,255,255,.03)}
    tbody tr:hover{background:rgba(255,255,255,.06)}

    /* Buttons */
    .btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .btn{
      flex:1; padding:12px 14px; border:none; border-radius:16px;
      color:#fff; font-weight:800; font-size:15px; letter-spacing:.2px;
      background:var(--grad-btn); box-shadow:0 10px 28px rgba(0,0,0,.25);
      cursor:pointer; transition:transform .05s ease, opacity .2s ease
    }
    .btn:active{transform:translateY(1px);opacity:.95}
    .ghost{background:rgba(255,255,255,.08); color:#e6f5ff; border:1px solid rgba(255,255,255,.25)}

    footer.signature{font-size:11px;color:#b4c4db;text-align:center;margin:20px auto 28px;max-width:980px;opacity:.9}

    /* Print header shown for Email (print) */
    @media print{
      #landing,.app-header,.btn-row,.modal{display:none !important}
      body{background:#fff; color:#111}
      .print-header{display:flex !important}
      .card{box-shadow:none;border:1px solid #ccc;background:#fff}
      table{border:1px solid #999}
      th,td{border-bottom:1px solid #999}
      footer.signature{display:none}
    }
    .print-header{display:none; align-items:center; gap:12px; margin:12px auto; max-width:980px}
    .print-header img{width:42px;height:42px;border-radius:8px}
    .print-header h1{font-size:20px; margin:0; color:#1E88E5}
    .print-header small{display:block; color:#333}

    .hidden{display:none !important}
  </style>
</head>

<body>
  <!-- Landing -->
  <section id="landing" aria-label="Welcome">
    <div class="hero" role="img" aria-label="Nurse with patient"></div>
    <div class="welcome">
      <div class="panel">
        <a href="#" class="brand-mark" id="brandTop">
          <img src="icons/icon-192.png" alt="Victoria Nurse Logo"/>
          <div>
            <h1>Victoria Nurse</h1>
            <div class="slogan">Care Together. Stay Together.</div>
          </div>
        </a>
        <button class="start-btn" id="startBtn">Start</button>
      </div>
    </div>
  </section>

  <!-- App header (brand returns to landing) -->
  <header class="app-header" id="appHeader">
    <a href="#" class="brand-link" id="homeLink" title="Back to Welcome">
      <img src="icons/icon-192.png" alt="Logo" class="logo" />
      <div>
        <h1>Victoria Nurse</h1>
        <div class="tag">Your digital nursing companion</div>
      </div>
    </a>
  </header>

  <!-- Print/PDF Header -->
  <div class="print-header">
    <img src="icons/icon-192.png" alt="Logo">
    <div>
      <h1>Victoria Nurse</h1>
      <small>Shared summary & vitals</small>
    </div>
  </div>

  <!-- Main App -->
  <main id="app" role="main" aria-label="Main app">
    <div class="wrap">
      <!-- Combined Form -->
      <div class="card">
        <h2>Patient Information</h2>
        <div class="grid">
          <div>
            <label for="patientName">Patient Name / Initials</label>
            <input id="patientName" placeholder="e.g., A. Mensah">
          </div>
          <div>
            <label for="weekOf">Week Of</label>
            <input type="date" id="weekOf">
          </div>
        </div>

        <div class="grid" style="margin-top:6px">
          <div>
            <label for="formMode">Form Section</label>
            <select id="formMode">
              <option value="patient">Patient Summary</option>
              <option value="nurse">Nurse Vital Signs</option>
            </select>
          </div>
          <div></div>
        </div>

        <!-- Patient-only -->
        <div id="patientOnly" class="grid" style="margin-top:4px">
          <div>
            <label for="startWeight">Starting Weight (kg)</label>
            <input id="startWeight" type="number" step="0.1" placeholder="e.g., 72.4">
          </div>
          <div>
            <label for="endWeight">Ending Weight (kg)</label>
            <input id="endWeight" type="number" step="0.1" placeholder="e.g., 71.9">
          </div>
          <div>
            <label for="recipient">Recipient WhatsApp (with country code)</label>
            <input id="recipient" placeholder="+23324XXXXXXX">
          </div>
          <div>
            <label for="note">Optional Note</label>
            <input id="note" placeholder="Short note (no sensitive identifiers)">
          </div>
        </div>

        <!-- Nurse-only -->
        <div id="nurseOnly" class="hidden" style="margin-top:6px">
          <h3 style="margin:8px 0 6px">Nurse Vital Signs</h3>
          <div class="grid">
            <div><label for="clNurse">Nurse Initials</label><input id="clNurse" placeholder="e.g., KB"></div>
            <div><label for="clTime">Time</label><input id="clTime" type="time"></div>

            <div><label>Temperature (°C/°F)</label><input id="clTemp"></div>
            <div><label>Pulse / HR (bpm)</label><input id="clHR" type="number"></div>
            <div><label>Respiratory Rate (/min)</label><input id="clRR" type="number"></div>
            <div><label>Blood Pressure (mmHg)</label><input id="clBP" placeholder="e.g., 120/80"></div>
            <div><label>Oxygen Saturation (SpO₂ %)</label><input id="clSpO2" type="number"></div>

            <div><label>Pain (0–10)</label><input id="clPain" type="number" min="0" max="10"></div>
            <div><label>LOC (AVPU/GCS)</label><input id="clLOC" placeholder="e.g., Alert / GCS 15"></div>
            <div><label>Blood Glucose</label><input id="clBGL" placeholder="mg/dL or mmol/L"></div>
            <div><label>Weight (kg)</label><input id="clWt" type="number" step="0.1"></div>
            <div><label>Height (cm)</label><input id="clHt" type="number" step="0.1"></div>
            <div><label>Intake (mL)</label><input id="clIn" type="number"></div>
            <div><label>Output (mL)</label><input id="clOut" type="number"></div>

            <div><label>Pulse Characteristics</label><input id="clPulse" placeholder="regular/irregular, strong/weak"></div>
            <div><label>Skin Signs</label><input id="clSkin" placeholder="warm/cool, dry/moist, color"></div>
            <div><label>Capillary Refill (sec)</label><input id="clCap" type="number" step="0.1"></div>
          </div>

          <label style="margin-top:10px">Notes</label>
          <textarea id="clNotes" rows="3" placeholder="Short clinical notes (no sensitive identifiers)"></textarea>
        </div>
      </div>

      <!-- Daily Vitals -->
      <div class="card">
        <h2>Daily Vitals</h2>
        <table id="vitalsTable" aria-label="Daily Vitals Table">
          <thead>
            <tr>
              <th>Day</th>
              <th>Time</th>
              <th>AM/PM</th>
              <th>Heart Rate</th>
              <th>Systolic</th>
              <th>Diastolic</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <div class="btn-row">
          <button class="btn" onclick="addRow()">Add Row</button>
          <button class="btn" onclick="addRowPair()">Add AM & PM</button>
          <button class="btn" onclick="doPreview()">Preview</button>
          <button class="btn" onclick="doShare()">Share via WhatsApp</button>
          <button class="btn" onclick="doExportPDF()">Email</button>
          <button class="btn ghost" onclick="clearTable()">Clear</button>
        </div>
      </div>
    </div>
  </main>

  <footer class="signature">
    Developed by <strong>Karl Brown</strong> • © <span id="year"></span>
  </footer>

  <!-- Preview Modal -->
  <div class="modal hidden" id="previewModal" aria-modal="true" role="dialog" aria-labelledby="previewTitle" style="position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;padding:16px;z-index:1000">
    <div class="sheet" style="background:#0f2748; border:1px solid #2a4466; color:#e6f5ff; border-radius:16px; max-width:680px; width:92vw; box-shadow:0 16px 40px rgba(0,0,0,.35); padding:16px">
      <h3 id="previewTitle" style="margin-bottom:10px">Preview message</h3>
      <pre id="previewText" style="white-space:pre-wrap;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.16);border-radius:12px;padding:12px;max-height:50vh;overflow:auto"></pre>
      <div class="btn-row" style="margin-top:12px">
        <button class="btn" onclick="copyPreview()">Copy</button>
        <button class="btn ghost" onclick="closePreview()">Close</button>
      </div>
    </div>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);

    /* ---------- Landing / Navigation ---------- */
    const startBtn = $("startBtn");
    const appHeader = $("appHeader");
    const homeLink = $("homeLink");
    const landing = $("landing");
    const appMain = $("app");

    startBtn.addEventListener('click', () => {
      landing.style.display = 'none';
      appMain.style.display = 'block';
      appHeader.style.display = 'flex';
      window.scrollTo({top:0, behavior:'smooth'});
    });
    homeLink.addEventListener('click', (e)=>{
      e.preventDefault();
      appMain.style.display = 'none';
      appHeader.style.display = 'none';
      landing.style.display = 'block';
      window.scrollTo({top:0, behavior:'smooth'});
    });

    /* ---------- Form switcher ---------- */
    const formMode = $("formMode");
    const patientOnly = $("patientOnly");
    const nurseOnly = $("nurseOnly");
    formMode.addEventListener('change', ()=>{
      const mode = formMode.value;
      if(mode === 'patient'){ patientOnly.classList.remove('hidden'); nurseOnly.classList.add('hidden'); }
      else { patientOnly.classList.add('hidden'); nurseOnly.classList.remove('hidden'); }
    });

    /* ---------- Daily vitals ---------- */
    function addRow(values={}){
      const tbody = document.querySelector("#vitalsTable tbody");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td data-label="Day"><input placeholder="Mon" value="${values.day||''}"></td>
        <td data-label="Time"><input type="time" value="${values.time||''}"></td>
        <td data-label="AM/PM">
          <select>
            <option ${values.meridiem==='AM'?'selected':''}>AM</option>
            <option ${values.meridiem==='PM'?'selected':''}>PM</option>
          </select>
        </td>
        <td data-label="Heart Rate"><input type="number" placeholder="bpm" value="${values.hr||''}"></td>
        <td data-label="Systolic"><input type="number" placeholder="mmHg" value="${values.sys||''}"></td>
        <td data-label="Diastolic"><input type="number" placeholder="mmHg" value="${values.dia||''}"></td>
      `;
      tbody.appendChild(tr);
    }
    function addRowPair(){ addRow({meridiem:'AM'}); addRow({meridiem:'PM'}); }
    function clearTable(){ document.querySelector("#vitalsTable tbody").innerHTML = ""; }

    /* ---------- Nurse checklist builder ---------- */
    function clBuildText(){
      const v = (id)=> (document.getElementById(id)?.value || '').trim();
      const lines = [
        `Nurse Checklist — ${v('patientName') || 'Patient'}`,
        `Week of: ${v('weekOf') || ''}  Time: ${v('clTime') || ''}  Nurse: ${v('clNurse') || ''}`,
        ``,
        `Core Vitals:`,
        `• Temp: ${v('clTemp') || '-'}  • HR: ${v('clHR') || '-'} bpm  • RR: ${v('clRR') || '-'} /min`,
        `• BP: ${v('clBP') || '-'} mmHg  • SpO₂: ${v('clSpO2') || '-'} %`,
        ``,
        `Extended:`,
        `• Pain: ${v('clPain') || '-'} /10  • LOC: ${v('clLOC') || '-'}`,
        `• BGL: ${v('clBGL') || '-'}  • Wt: ${v('clWt') || '-'} kg  • Ht: ${v('clHt') || '-'} cm`,
        `• Intake: ${v('clIn') || '-'} mL  • Output: ${v('clOut') || '-'} mL`,
        ``,
        `Observations:`,
        `• Pulse: ${v('clPulse') || '-'}`,
        `• Skin: ${v('clSkin') || '-'}`,
        `• Cap refill: ${v('clCap') || '-'} sec`,
        ``,
        `Notes: ${v('clNotes') || ''}`
      ];
      return lines.join('\n');
    }

    /* ---------- Gather text ---------- */
    function gather(){
      const name = $("patientName").value.trim() || "Patient";
      const week = $("weekOf").value || "(week not set)";
      const sw = $("startWeight")?.value;
      const ew = $("endWeight")?.value;
      const note = $("note")?.value?.trim() || "";

      const rows = [...document.querySelectorAll("#vitalsTable tbody tr")].map(tr=>{
        const day  = tr.children[0].querySelector('input').value || '';
        const time = tr.children[1].querySelector('input').value || '';
        const ampm = tr.children[2].querySelector('select').value || '';
        const hr   = tr.children[3].querySelector('input').value || '';
        const sys  = tr.children[4].querySelector('input').value || '';
        const dia  = tr.children[5].querySelector('input').value || '';
        return `• ${day} ${time} ${ampm} — HR ${hr} bpm, ${sys}/${dia} mmHg`;
      });

      let msg = `Victoria Nurse — ${name}\nWeek of ${week}\n`;
      if (sw) msg += `Start Wt: ${sw} kg\n`;
      if (ew) msg += `End Wt: ${ew} kg\n`;
      msg += `\nDaily Vitals:\n`;
      msg += rows.length ? rows.join('\n') + '\n' : '  (no rows yet)\n';
      if (note) msg += `\nNote: ${note}\n`;

      // If Nurse section is visible when sharing, append it
      if (!nurseOnly.classList.contains('hidden')) {
        msg += `\n————————————\n` + clBuildText();
      }
      return msg;
    }

    /* ---------- Clear everything after sharing ---------- */
    function clearAll(){
      document.querySelectorAll('input').forEach(el => {
        if (['date','time','number','text'].includes(el.type)) el.value = '';
      });
      document.querySelectorAll('textarea').forEach(el => el.value = '');
      clearTable();
      formMode.value = 'patient';
      patientOnly.classList.remove('hidden'); nurseOnly.classList.add('hidden');
    }

    /* ---------- Preview / Share / Email ---------- */
    function doPreview(){
      $("previewText").textContent = gather();
      $("previewModal").classList.remove('hidden');
    }
    function closePreview(){ $("previewModal").classList.add('hidden'); }
    function copyPreview(){
      navigator.clipboard.writeText($("previewText").textContent).then(()=> alert("Copied!"));
    }

    function doShare(){
      const text = gather();
      const phone = $("recipient")?.value?.trim();
      const wa = phone ? `https://wa.me/${encodeURIComponent(phone)}?text=${encodeURIComponent(text)}`
                       : `https://wa.me/?text=${encodeURIComponent(text)}`;
      window.open(wa, "_blank");
      clearAll();
    }

    // “Email” triggers print-to-PDF (user can share/attach via Mail)
    function doExportPDF(){
      window.print();
      clearAll();
    }

    /* ---------- Footer year ---------- */
    (function(){ const y=$("year"); if (y) y.textContent = new Date().getFullYear(); })();

    /* ---------- Service worker ---------- */
    if ('serviceWorker' in navigator){
      window.addEventListener('load', () => {
        try { navigator.serviceWorker.register('./service-worker.js'); }
        catch(e){ console.warn('SW register failed', e); }
      });
    }

    /* ---------- Shortcuts (?action=...) ---------- */
    (function(){
      const params = new URLSearchParams(location.search);
      const action = (params.get('action')||'').toLowerCase();
      const run = () => {
        try {
          switch(action){
            case 'add-reading': addRowPair(); break;
            case 'preview': doPreview(); break;
            case 'export': doExportPDF(); break;
            case 'share': doShare(); break;
            default: break;
          }
        } catch(e){ console.error('Shortcut failed', e); }
      };
      if (document.readyState === 'complete') setTimeout(run, 150);
      else window.addEventListener('load', ()=> setTimeout(run,150));
    })();
  </script>
</body>
</html>
